{% extends "Cyber_News_App/base_layout.html" %}

{% block content %}
    <div class="thread-detail"> <!-- Link to go to list -->
        <h1>{{ thread.thread_name }}</h1>
        <form method="post" >
            {% csrf_token %}
            {%if user.is_moderator or user == thread.author_id %}
                <h3><a href="{% url 'article_pages:thread_edit' thread.id %}">edit</a></h3>
                {%if thread.is_active == True %}
                    <input type="submit" name="deactivate" value="Remove Thread">
                {%elif thread.is_active == False %}
                    <input type="submit" name="activate" value="Return Thread">
                {% endif %}
            {% endif %}
        </form>
        <!--  </h1>
        <h2><a href="{% url 'game_pages:game_det' thread.game_id.id %}">Source</a> </h2> -->
        <p>{{thread.thread_date }}</p>
        <p>{{ thread.thread_text }}</p>
    </div>

    {%if user.is_authenticated%}
        <form class="" action="" method="post">
        {% csrf_token %}
        <textarea name="comments_text" rows="8" cols="80" placeholder="Leave your thoughts"></textarea>         <!-- some stuff-->
        <br><input type="submit" name="post_comment" value="Submit">
        </form>
    {%endif%}

  <h3>Comments: </h3>
  <button onclick="all_comments(1)">Hide</button>
  <button onclick="all_comments(2)">Show</button>
  {% if comments %}
      <form id="all_comments" class="" action="" method="post">

      {% csrf_token %}
            {% for comment in comments %}
                <p>
                    <b>*{{comment.author.username}}* left this comment: </b>
                {%if user == comment.author %}
                    <a href="{% url 'article_pages:comment_edit' comment.id %}">Edit</a>
                {% endif %}</p>
                <p> {{comment.comments_text}}</p>
                {% if comment.receiver %}
                    Replied To: {{ comment.receiver.username }} <br><br>
                {% endif %}

                {%if user.is_authenticated %}
                    {%if user not in comment.upvoters.all %}
                        Upvote <input type="submit" name="upvote_comment" value="{{ comment.id }}" style="color: gray; background: gray; width: 45px"> {{ comment.upvoters.count }}
                    {% else %}
                        Remove Upvote<input type="submit" name="remove_upvote_comment" value="{{ comment.id }}" style="color: gray; background: gray; width: 45px"> {{ comment.upvoters.count }}
                    {% endif %}
                {% endif %}
            {% endfor %}
      </form>
  {% else %}
    <p>No comments on this article yet</p>
  {% endif %}

    <script type="text/javascript">
        function all_comments(a){
            if(a==1)
                document.getElementById("all_comments").style.display="none";
            else
                document.getElementById("all_comments").style.display="block";
        }
    </script>
  {% endblock content%}
